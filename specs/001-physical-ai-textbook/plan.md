# Implementation Plan: Physical AI & Humanoid Robotics Interactive Textbook

**Branch**: `001-physical-ai-textbook` | **Date**: 2025-12-08 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-physical-ai-textbook/spec.md`

**Note**: This document outlines the technical architecture and implementation strategy for building an interactive textbook platform with RAG chatbot, authentication, and personalization features.

## Summary

Build a comprehensive web-based interactive textbook for teaching Physical AI & Humanoid Robotics, featuring:
- Static site generation with Docusaurus for content delivery
- FastAPI backend for RAG chatbot and personalization services
- Better-auth for user authentication and profile management
- Neon Serverless Postgres for user data and chat history (24-hour retention)
- Qdrant Cloud vector database for semantic search over textbook content
- OpenAI Agents/ChatKit for natural language Q&A grounded in textbook material
- GitHub Pages deployment for public accessibility
- Personalized learning path recommendations based on user background

## Technical Context

**Frontend Stack**:
- **Framework**: Docusaurus 3.x (React-based static site generator)
- **Language/Version**: TypeScript 5.x, Node.js 20.x LTS
- **UI Library**: React 18.x (included with Docusaurus)
- **Styling**: CSS Modules / Tailwind CSS (NEEDS CLARIFICATION: which styling approach)
- **State Management**: React Context API for user session, TanStack Query for server state
- **Build Tool**: Webpack (bundled with Docusaurus)

**Backend Stack**:
- **Language/Version**: Python 3.11+
- **Framework**: FastAPI 0.109+
- **Primary Dependencies**:
  - OpenAI Python SDK 1.x (for Agents/ChatKit integration)
  - Qdrant Client for vector operations
  - PostgreSQL driver (asyncpg or psycopg3)
  - Pydantic 2.x for data validation
  - LangChain or LlamaIndex (NEEDS CLARIFICATION: which RAG framework)
- **Authentication**: Better-auth integration (NEEDS CLARIFICATION: Python SDK availability or REST API)
- **API Documentation**: OpenAPI/Swagger (auto-generated by FastAPI)

**Storage**:
- **Relational Database**: Neon Serverless Postgres (for user profiles, sessions, chat history)
- **Vector Database**: Qdrant Cloud Free Tier (for textbook content embeddings)
- **Static Assets**: GitHub Pages CDN (textbook content, images, diagrams)
- **Secrets Management**: Environment variables (.env files, GitHub Secrets for deployment)

**AI/ML**:
- **Embedding Model**: OpenAI text-embedding-ada-002 or text-embedding-3-small
- **Chat Model**: OpenAI GPT-4 or GPT-4-turbo for chatbot responses
- **RAG Framework**: NEEDS CLARIFICATION (LangChain vs LlamaIndex vs custom implementation)
- **Vector Search**: Qdrant semantic search with hybrid filtering

**Testing**:
- **Frontend**: Jest + React Testing Library (included with Docusaurus)
- **Backend**: pytest + pytest-asyncio for async tests
- **API Testing**: httpx for async HTTP testing
- **E2E**: Playwright (NEEDS CLARIFICATION: if needed for this phase)
- **Vector Search**: Unit tests with mock Qdrant client

**Deployment**:
- **Frontend**: GitHub Pages (static site hosting)
- **Backend**: NEEDS CLARIFICATION (Vercel, Railway, Render, or other serverless platform)
- **Database**: Neon cloud-hosted (no deployment needed)
- **Vector DB**: Qdrant Cloud (no deployment needed)
- **CI/CD**: GitHub Actions for build and deployment

**Target Platform**:
- Web browsers (Chrome, Firefox, Safari, Edge - latest 2 versions)
- Responsive design for desktop, tablet, mobile
- Backend: Linux server or serverless containers

**Project Type**: Web application (separate frontend and backend with API)

**Performance Goals**:
- Page load time: <3 seconds on 10Mbps connection
- Chatbot response latency: <5 seconds for 95th percentile
- API response time: <500ms for user profile/auth operations
- Vector search: <2 seconds for semantic queries
- Support 100 concurrent users without degradation

**Constraints**:
- Free tier usage for Neon Postgres (1GB storage limit)
- Free tier usage for Qdrant Cloud (1GB cluster)
- GitHub Pages static hosting (no server-side rendering)
- 24-hour chat history retention (automatic purging required)
- Chatbot responses must cite textbook sources (no hallucinations)
- User data security (password hashing, secure session management)

**Scale/Scope**:
- Initial content: 4 modules, 13-week curriculum, ~20-30 chapters
- Estimated users: 100-500 concurrent learners
- Vector embeddings: ~50k-100k chunks (estimated from textbook content)
- Chat conversations: 100s active per day, auto-purged after 24 hours
- Storage needs: <1GB for user profiles, <1GB for vector embeddings

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

**Note**: Project constitution is not yet established (template only in `.specify/memory/constitution.md`). This project should establish principles through `/sp.constitution` command if architectural governance is needed.

**Preliminary Architectural Guidelines** (to be formalized if needed):

✅ **Separation of Concerns**: Frontend (static site) and backend (API) are clearly separated
✅ **Stateless API**: Backend API should be stateless, session state managed client-side or in database
✅ **Security First**: User authentication, password hashing, secure secrets management required
✅ **Cost Consciousness**: Using free tiers for databases (Neon, Qdrant) appropriate for MVP
✅ **Testability**: Testing frameworks identified for both frontend and backend
⚠️ **Complexity Justified**: Multiple external services (Neon, Qdrant, OpenAI, Better-auth) add integration complexity - justified by feature requirements

## Project Structure

### Documentation (this feature)

```text
specs/001-physical-ai-textbook/
├── plan.md              # This file (/sp.plan command output)
├── research.md          # Phase 0 output - technology research and decisions
├── data-model.md        # Phase 1 output - database schemas and entities
├── quickstart.md        # Phase 1 output - development setup guide
├── contracts/           # Phase 1 output - API contracts
│   ├── openapi.yaml     # FastAPI backend OpenAPI spec
│   └── types.ts         # Shared TypeScript types for frontend
├── checklists/          # Quality validation
│   └── requirements.md  # Spec validation checklist (already exists)
└── tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)
```

### Source Code (repository root)

**Selected Structure**: Web application with separate frontend and backend

```text
# Frontend - Docusaurus static site
docs/                           # Docusaurus content directory
├── curriculum/                 # Course curriculum chapters
│   ├── introduction.md         # Focus & goal, quarter overview
│   ├── module-1/               # ROS 2 fundamentals
│   ├── module-2/               # Digital Twin & Gazebo
│   ├── module-3/               # AI-Robot Brain & Isaac
│   └── module-4/               # VLA & LLMs for robotics
├── hardware/                   # Hardware requirements
│   ├── workstation.md          # Digital Twin Workstation specs
│   └── edge-kit.md             # Physical AI Edge Kit specs
└── architecture/               # System architecture diagrams

src/                            # Docusaurus custom React components
├── components/
│   ├── ChatBot/                # Embedded RAG chatbot UI
│   │   ├── ChatBot.tsx
│   │   ├── MessageList.tsx
│   │   ├── TextSelector.tsx   # Selected text Q&A feature
│   │   └── ChatInput.tsx
│   ├── Auth/                   # Authentication components
│   │   ├── SignIn.tsx
│   │   ├── SignUp.tsx
│   │   └── ProfileForm.tsx    # User background collection
│   ├── Personalization/
│   │   ├── PersonalizeButton.tsx
│   │   └── LearningPathWidget.tsx
│   └── Layout/
│       └── CustomLayout.tsx   # Override Docusaurus layout
├── hooks/
│   ├── useAuth.ts              # Better-auth integration
│   ├── useChat.ts              # Chat API integration
│   └── usePersonalization.ts  # Personalization state
├── services/
│   ├── api.ts                  # Backend API client
│   ├── auth.ts                 # Auth service
│   └── storage.ts              # Local storage for session
└── types/
    └── index.ts                # TypeScript type definitions

docusaurus.config.js            # Docusaurus configuration
sidebars.js                     # Navigation structure
package.json                    # Frontend dependencies

# Backend - FastAPI application
backend/
├── app/
│   ├── main.py                 # FastAPI application entry
│   ├── config.py               # Environment configuration
│   ├── dependencies.py         # Shared dependencies (DB, auth)
│   ├── models/                 # Pydantic models & SQLAlchemy ORM
│   │   ├── user.py             # User profile model
│   │   ├── chat.py             # Chat conversation model
│   │   └── recommendation.py  # Learning path model
│   ├── routers/                # API endpoints
│   │   ├── auth.py             # Sign up, sign in, profile
│   │   ├── chat.py             # Chatbot Q&A endpoints
│   │   ├── personalization.py # Learning path recommendations
│   │   └── content.py          # Content retrieval (if needed)
│   ├── services/               # Business logic
│   │   ├── auth_service.py     # Better-auth integration
│   │   ├── rag_service.py      # RAG implementation (OpenAI + Qdrant)
│   │   ├── embedding_service.py # Text embedding generation
│   │   ├── recommendation_service.py # Personalization logic
│   │   └── cleanup_service.py  # 24-hour chat history purging
│   ├── database/
│   │   ├── postgres.py         # Neon Postgres connection
│   │   ├── qdrant.py           # Qdrant vector DB connection
│   │   └── migrations/         # Alembic migrations
│   └── utils/
│       ├── security.py         # Password hashing, tokens
│       └── validators.py       # Input validation helpers
├── tests/
│   ├── conftest.py             # pytest fixtures
│   ├── unit/                   # Unit tests
│   │   ├── test_rag_service.py
│   │   └── test_auth_service.py
│   ├── integration/            # Integration tests
│   │   ├── test_chat_api.py
│   │   └── test_auth_flow.py
│   └── contract/               # API contract tests
│       └── test_openapi_compliance.py
├── requirements.txt            # Python dependencies
├── pyproject.toml              # Python project config
└── README.md                   # Backend setup instructions

# Infrastructure & Configuration
.github/
└── workflows/
    ├── deploy-frontend.yml     # GitHub Pages deployment
    └── deploy-backend.yml      # Backend deployment (platform TBD)

scripts/
├── seed-vector-db.py           # Populate Qdrant with textbook embeddings
├── cleanup-chat-history.py    # 24-hour purge cron job
└── generate-sample-content.md  # Sample curriculum content generator

.env.example                    # Environment variables template
docker-compose.yml              # Local development environment (OPTIONAL)
```

**Structure Decision**:
- **Web application pattern** chosen because we have a static frontend (Docusaurus) and a separate backend API (FastAPI)
- **Docusaurus** manages content organization via `docs/` directory with markdown files
- **Custom React components** in `src/` for interactive features (chatbot, auth, personalization)
- **Backend** is completely separate Python application with FastAPI
- **Clear separation** enables independent deployment: frontend to GitHub Pages, backend to serverless platform
- **Scripts directory** for operational tasks (seeding vector DB, cleanup cron jobs)

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

Since no formal constitution exists yet, documenting key complexity decisions here:

| Decision | Why Needed | Simpler Alternative Rejected Because |
|----------|------------|-------------------------------------|
| Multiple external services (Neon, Qdrant, OpenAI, Better-auth) | Each service provides specialized capability required by spec: relational storage, vector search, AI chat, authentication | Monolithic database approach would require building vector search (complex), embedding generation (expensive), and auth (security risk) from scratch |
| Separate frontend and backend | Docusaurus is static site generator (no server-side code), chatbot requires server-side processing (API calls, database access) | Combined approach impossible due to static site limitations; API gateway pattern necessary for GitHub Pages deployment |
| RAG framework dependency | Implementing retrieval-augmented generation from scratch requires significant ML expertise and error-prone prompt engineering | Custom implementation would delay project, introduce bugs, and fail to leverage established best practices for citation accuracy |
| 24-hour chat history retention with purging | Balances user utility (resume conversations) with storage cost (free tier limits) and privacy (no long-term data retention) | Session-only storage loses value when users refresh browser; permanent storage exceeds free tier limits and raises privacy concerns |

**Justification Summary**: Complexity is inherent to requirements - RAG chatbot, personalization, and authentication each require specialized infrastructure. Free tier constraints make managed services (Neon, Qdrant) more viable than self-hosted alternatives.

## Phase 0: Research & Technology Decisions

**Status**: NEEDS COMPLETION - See research.md

### Research Questions to Resolve

1. **Better-auth Integration Strategy**
   - Question: Does better-auth provide a Python SDK, or do we use REST API directly?
   - Impact: Determines backend integration approach
   - Research tasks: Check better-auth documentation, explore SDK availability, evaluate alternatives if needed

2. **RAG Framework Selection**
   - Question: Use LangChain, LlamaIndex, or custom RAG implementation?
   - Impact: Development velocity, citation accuracy, maintenance burden
   - Research tasks: Compare frameworks for Qdrant integration, OpenAI compatibility, citation extraction

3. **Frontend Styling Approach**
   - Question: Use Docusaurus default CSS, CSS Modules, or add Tailwind CSS?
   - Impact: Development speed, design consistency, bundle size
   - Research tasks: Evaluate Docusaurus theming capabilities, Tailwind integration complexity

4. **Backend Deployment Platform**
   - Question: Deploy FastAPI to Vercel, Railway, Render, Fly.io, or other platform?
   - Impact: Cost, performance, deployment complexity, free tier availability
   - Research tasks: Compare serverless Python hosting options, evaluate free tiers, assess cold start times

5. **E2E Testing Requirements**
   - Question: Is Playwright E2E testing needed for MVP, or sufficient for later phases?
   - Impact: Test coverage, development time, CI/CD complexity
   - Research tasks: Assess critical user flows, evaluate risk of manual testing for MVP

6. **Content Embedding Strategy**
   - Question: How to chunk textbook content for optimal retrieval (by section, paragraph, semantic similarity)?
   - Impact: RAG accuracy, storage costs, query relevance
   - Research tasks: Research chunking best practices, test chunk sizes for curriculum content

7. **Personalization Implementation**
   - Question: How to adapt content presentation - dynamic rendering, pre-generated variants, or AI-generated summaries?
   - Impact: Development complexity, cost (API calls), user experience
   - Research tasks: Evaluate content personalization patterns, assess LLM-based adaptation feasibility

**Output**: `research.md` document with detailed findings and decisions for all questions above

## Phase 1: Design & Contracts

**Status**: PENDING RESEARCH COMPLETION

**Prerequisites**: All research questions resolved in `research.md`

### Deliverables

1. **data-model.md**: Database schemas and entity relationships
   - User profile schema (Postgres)
   - Chat conversation schema with 24-hour TTL (Postgres)
   - Learning path recommendation schema (Postgres)
   - Vector embedding metadata structure (Qdrant)
   - State transitions for chat sessions

2. **contracts/openapi.yaml**: FastAPI backend API specification
   - Authentication endpoints (sign up, sign in, sign out, profile)
   - Chat endpoints (send message, get history, select text Q&A)
   - Personalization endpoints (get recommendations, toggle personalization)
   - Content endpoints (if needed for dynamic content)

3. **contracts/types.ts**: Shared TypeScript types
   - User profile interface
   - Chat message interface
   - API request/response types
   - Personalization configuration types

4. **quickstart.md**: Development environment setup guide
   - Prerequisites installation (Node.js, Python, PostgreSQL/Neon setup)
   - Frontend setup (Docusaurus, dependencies)
   - Backend setup (FastAPI, virtual environment, environment variables)
   - Database migrations (Alembic)
   - Vector DB seeding (Qdrant, embedding generation)
   - Running development servers
   - Testing setup

**Note**: Phase 1 execution will create all deliverables listed above after research questions are resolved.

## Next Steps

1. **Execute Phase 0**: Create `research.md` to resolve all technical clarifications
2. **Execute Phase 1**: Generate data models and API contracts based on research decisions
3. **Update Agent Context**: Run `.specify/scripts/bash/update-agent-context.sh claude` to capture technology stack
4. **Run `/sp.tasks`**: Generate detailed implementation tasks after planning is complete

---

**Planning Status**: Phase 0 (Research) IN PROGRESS
**Blocked By**: Technology decision research (see Research Questions above)
**Next Command**: Proceed to research.md creation
